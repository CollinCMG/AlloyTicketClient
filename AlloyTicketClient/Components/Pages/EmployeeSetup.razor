@using Microsoft.AspNetCore.Authorization
@using AlloyTicketClient.Models
@inject IConfiguration Configuration

@page "/employee"
@attribute [Authorize]
@rendermode InteractiveServer

<PageTitle>Employee Request</PageTitle>

<div class="employee-setup-container">
    <h1 class="employee-setup-title">Employee Request</h1>
    <div class="employee-setup-subtitle">
        Would you like to add a new employee or remove an existing employee?
    </div>
    <div class="employee-setup-help">
        <em>(for all other user requests, please contact the Help Desk.)</em>
    </div>
    <div class="employee-setup-buttons">
        @if (employeeActions != null)
        {
            foreach (var action in employeeActions)
            {
                <button class="employee-btn add-btn"
                        @onclick="() => ShowEmployeeAction(action)">
                    @action.ButtonName
                </button>
            }
        }
    </div>
</div>

<EmployeeSlideOver Show="showSlideOver"
                   Title="@slideOverTitle"
                   Payload="@slideOverPayload"
                   OnClose="CloseSlideOver" />

@code {
    private bool showSlideOver = false;
    private string? slideOverTitle;
    private EmployeeActionPayload? slideOverPayload;
    private List<EmployeeAction>? employeeActions;

    protected override void OnInitialized()
    {
        // Read EmployeeActions from appsettings.json
        employeeActions = Configuration.GetSection("EmployeeActions").Get<List<EmployeeAction>>();
    }

    private void ShowEmployeeAction(EmployeeAction action)
    {
        slideOverTitle = action.ButtonName + " Request";
        slideOverPayload = new EmployeeActionPayload
        {
            FormId = action.FormId,
            Data = new Dictionary<string, object?>(),
            CategoryId = action.CategoryId,
            Route = action.Route
        };
        showSlideOver = true;
    }

    private void CloseSlideOver()
    {
        showSlideOver = false;
        slideOverTitle = null;
        slideOverPayload = null;
    }
}

@page "/"
@rendermode InteractiveServer

@using Microsoft.Extensions.Configuration
@using AlloyTicketClient.Models
@inject IConfiguration Configuration

<PageTitle>Ticket</PageTitle>

<div class="ticket-request-container">
    <h1 class="ticket-request-title">New Support Request</h1>
    <div class="ticket-request-subtitle">Complete the following form to submit a new support request to the Help Desk.</div>
    <div class="ticket-request-help mb-3">
    </div>
    <div class="ticket-action-buttons" style="display: flex; gap: 1.5rem;">
        @if (ticketActions != null)
        {
            foreach (var action in ticketActions)
            {
                <button class="ticket-btn add-btn" @onclick="() => ShowTicketAction(action)">
                    @action.ButtonName
                </button>
            }
        }
    </div>
</div>

<EmployeeSlideOver Show="showSlideOver"
                   Title="@slideOverTitle"
                   Payload="@slideOverPayload"
                   OnClose="CloseSlideOver" />

@code {
    private bool showSlideOver = false;
    private string? slideOverTitle;
    private EmployeeActionPayload? slideOverPayload;
    private List<EmployeeAction>? ticketActions;

    protected override void OnInitialized()
    {
        ticketActions = Configuration.GetSection("TicketActions").Get<List<EmployeeAction>>();
    }

    private void ShowTicketAction(EmployeeAction action)
    {
        slideOverTitle = action.ButtonName + " Request";
        slideOverPayload = new EmployeeActionPayload
        {
            FormId = action.FormId,
            Data = action, // Pass the whole object as Data
            CategoryId = action.CategoryId,
            Route = action.Route
        };
        showSlideOver = true;
    }

    private void CloseSlideOver()
    {
        showSlideOver = false;
        slideOverTitle = null;
        slideOverPayload = null;
    }
}
